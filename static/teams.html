<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>U Bible - Team Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.1;
            background-image:
                radial-gradient(circle at 20% 50%, rgba(76, 175, 80, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(34, 197, 94, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.2) 0%, transparent 50%);
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(76, 175, 80, 0.6);
            border-radius: 50%;
            animation: particleFloat 20s infinite linear;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) translateX(0) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px) scale(0);
                opacity: 0;
            }
        }

        /* Main Container */
        .app-container {
            width: 96%;
            max-width: 1600px;
            margin: 20px auto;
            min-height: calc(100vh - 40px);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 10;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 16px rgba(34, 197, 94, 0.4);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .app-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: #fff;
            letter-spacing: -0.5px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .home-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            padding: 10px 24px;
            border-radius: 10px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 32px 24px;
            display: flex;
            flex-direction: column;
        }

        .main-content::-webkit-scrollbar {
            width: 10px;
        }

        .main-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
        }

        .main-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 5px;
        }

        .main-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .content-wrapper {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #fff;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        /* Tabs - Improved */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 36px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 14px;
            overflow-x: auto;
            justify-content: center;
        }

        .tab {
            padding: 12px 28px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
            white-space: nowrap;
            position: relative;
        }

        .tab:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            color: #22c55e;
            background: rgba(34, 197, 94, 0.15);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.2);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Action Bar - Improved */
        .action-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            color: #fff;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 16px rgba(34, 197, 94, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
        }

        /* Teams Grid - Improved */
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .team-card {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .team-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(34, 197, 94, 0.3);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .team-card:hover::before {
            transform: scaleX(1);
        }

        .team-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }

        .team-icon {
            font-size: 36px;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.2));
            border-radius: 12px;
            flex-shrink: 0;
        }

        .team-info {
            flex: 1;
        }

        .team-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
            letter-spacing: -0.3px;
        }

        .team-code {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 6px;
            display: inline-block;
            font-family: 'Courier New', monospace;
        }

        .team-description {
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
            margin: 16px 0;
            font-size: 0.95rem;
        }

        /* Team Stats - Improved */
        .team-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        .stat {
            text-align: center;
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .stat:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: #22c55e;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Search Bar */
        .search-bar-container {
            margin-bottom: 32px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            padding: 6px 6px 6px 16px;
            max-width: 600px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .search-bar:focus-within {
            border-color: #22c55e;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }

        .search-icon {
            font-size: 1.2rem;
            opacity: 0.6;
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1rem;
            outline: none;
            font-family: inherit;
            padding: 10px 0;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .clear-search {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .clear-search.active {
            display: flex;
        }

        .clear-search:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .search-hint {
            text-align: center;
            margin-top: 12px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .search-hint kbd {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        mark {
            background: rgba(34, 197, 94, 0.3);
            color: #fff;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .search-results-count {
            text-align: center;
            margin-top: 16px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Leaderboard */
        .leaderboard-select {
            margin-bottom: 28px;
            display: flex;
            justify-content: center;
        }

        .leaderboard-select select {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            min-width: 280px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .leaderboard-select select:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .leaderboard-select select option {
            background: #1e293b;
            color: #fff;
        }

        .leaderboard-table {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 80px 1fr 120px 100px;
            gap: 20px;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.06);
            font-weight: 700;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 80px 1fr 120px 100px;
            gap: 20px;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            align-items: center;
        }

        .leaderboard-row:last-child {
            border-bottom: none;
        }

        .leaderboard-row:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .rank {
            font-size: 1.3rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rank.gold {
            color: #fbbf24;
            font-size: 1.5rem;
        }

        .rank.silver {
            color: #cbd5e1;
            font-size: 1.4rem;
        }

        .rank.bronze {
            color: #fb923c;
            font-size: 1.4rem;
        }

        .rank::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .rank.gold::before,
        .rank.silver::before,
        .rank.bronze::before {
            width: 12px;
            height: 12px;
            box-shadow: 0 0 12px currentColor;
        }

        .player-name {
            font-size: 1.05rem;
            font-weight: 600;
            color: #fff;
        }

        .score {
            font-size: 1.2rem;
            font-weight: 700;
            color: #22c55e;
            text-align: center;
        }

        .games {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
            text-align: center;
            font-weight: 600;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .empty-text {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 24px;
            font-weight: 500;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 36px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }

        .modal-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: #fff;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.3rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            padding: 14px 16px;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #22c55e;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
        }

        .form-checkbox input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .teams-grid {
                grid-template-columns: 1fr;
            }

            .leaderboard-header,
            .leaderboard-row {
                grid-template-columns: 60px 1fr 80px 70px;
                gap: 12px;
                font-size: 0.85rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .tabs {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="background-pattern"></div>
    <div class="particles" id="particles"></div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo-area">
                <div class="logo">👥</div>
                <div class="app-title">Team Portal</div>
            </div>
            <div class="header-actions">
                <button class="home-btn" onclick="window.location.href='/'">
                    🏠 Home
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-wrapper">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">Team Portal</h1>
                    <p class="page-subtitle">Connect, compete, and grow together</p>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('my-teams')">📋 My Teams</button>
                    <button class="tab" onclick="switchTab('public-teams')">🌍 Discover</button>
                    <button class="tab" onclick="switchTab('themes')">📚 Themes</button>
                    <button class="tab" onclick="switchTab('challenges')">🎯 Challenges</button>
                    <button class="tab" onclick="switchTab('leaderboard')">🏆 Leaderboard</button>
                </div>

                <!-- My Teams Tab -->
                <div id="my-teams" class="tab-content active">
                    <div class="action-bar">
                        <button class="btn" onclick="showCreateTeamModal()">➕ Create Team</button>
                        <button class="btn btn-secondary" onclick="showJoinTeamModal()">🔗 Join Team</button>
                    </div>
                    <div class="teams-grid" id="my-teams-list"></div>
                </div>

                <!-- Public Teams Tab -->
                <div id="public-teams" class="tab-content">
                    <div class="search-bar-container">
                        <div class="search-bar">
                            <span class="search-icon">🔍</span>
                            <input
                                type="text"
                                id="teamSearchInput"
                                class="search-input"
                                placeholder="Search teams by name, description, or code..."
                                oninput="searchTeams()"
                            >
                            <button class="clear-search" id="clearSearchBtn" onclick="clearSearch()">×</button>
                        </div>
                        <div class="search-hint">Press <kbd>/</kbd> to search • <kbd>Esc</kbd> to clear</div>
                        <div class="search-results-count" id="searchResultsCount"></div>
                    </div>
                    <div class="teams-grid" id="public-teams-list"></div>
                </div>

                <!-- Themes Tab -->
                <div id="themes" class="tab-content">
                    <div class="action-bar">
                        <button class="btn" onclick="showCreateThemeModal()">➕ Create Theme</button>
                    </div>
                    <div id="themes-list"></div>
                </div>

                <!-- Challenges Tab -->
                <div id="challenges" class="tab-content">
                    <div class="action-bar">
                        <button class="btn" onclick="showCreateChallengeModal()">➕ Create Challenge</button>
                    </div>
                    <div id="challenges-list"></div>
                </div>

                <!-- Leaderboard Tab -->
                <div id="leaderboard" class="tab-content">
                    <div class="leaderboard-select">
                        <select id="leaderboardTeamSelect" onchange="loadLeaderboard()">
                            <option value="">Select a team...</option>
                        </select>
                    </div>
                    <div id="leaderboard-table"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Team Modal -->
    <div id="createTeamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Team</h2>
                <button class="close-btn" onclick="hideModal('createTeamModal')">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Team Name *</label>
                <input type="text" id="teamName" class="form-input" placeholder="Enter team name">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="teamDescription" class="form-textarea" placeholder="Tell others about your team"></textarea>
            </div>
            <div class="form-checkbox">
                <input type="checkbox" id="teamPublic" checked>
                <label class="form-label" style="margin: 0">Make team public</label>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="createTeam()">Create Team</button>
                <button class="btn btn-secondary" onclick="hideModal('createTeamModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Join Team Modal -->
    <div id="joinTeamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Join a Team</h2>
                <button class="close-btn" onclick="hideModal('joinTeamModal')">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Team Code *</label>
                <input type="text" id="joinTeamCode" class="form-input" placeholder="Enter team code" style="text-transform: uppercase;">
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="joinTeam()">Join Team</button>
                <button class="btn btn-secondary" onclick="hideModal('joinTeamModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal (styled like index.html) -->
    <div id="alertModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header" style="text-align: center; border-bottom: none;">
                <h2 id="alertTitle" class="modal-title" style="font-size: 1.8rem; margin-bottom: 0;"></h2>
            </div>
            <p id="alertMessage" style="text-align: center; color: rgba(255, 255, 255, 0.9); font-size: 1.1rem; margin: 20px 0; line-height: 1.6;"></p>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn" onclick="hideAlert()" style="min-width: 120px;">OK</button>
            </div>
        </div>
    </div>

    <!-- Create Theme Modal -->
    <div id="createThemeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Team Theme</h2>
                <button class="close-btn" onclick="hideModal('createThemeModal')">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Select Team *</label>
                <select id="themeTeamSelect" class="form-input">
                    <option value="">Select a team...</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Theme Name *</label>
                <input type="text" id="themeName" class="form-input" placeholder="Enter theme name">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="themeDescription" class="form-textarea" placeholder="Describe this theme"></textarea>
            </div>
            <div class="form-checkbox">
                <input type="checkbox" id="themePublic" checked>
                <label class="form-label" style="margin: 0">Make theme public (visible to all users)</label>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="createTheme()">Create Theme</button>
                <button class="btn btn-secondary" onclick="hideModal('createThemeModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Create Challenge Modal -->
    <div id="createChallengeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Team Challenge</h2>
                <button class="close-btn" onclick="hideModal('createChallengeModal')">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Select Team *</label>
                <select id="challengeTeamSelect" class="form-input">
                    <option value="">Select a team...</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Challenge Name *</label>
                <input type="text" id="challengeName" class="form-input" placeholder="Enter challenge name">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="challengeDescription" class="form-textarea" placeholder="Describe this challenge"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Select Theme *</label>
                <select id="challengeThemeSelect" class="form-input">
                    <option value="">Select a theme...</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Number of Questions *</label>
                <input type="number" id="challengeQuestions" class="form-input" placeholder="10" min="5" max="50" value="10">
            </div>
            <div class="form-group">
                <label class="form-label">Time Limit (seconds) *</label>
                <input type="number" id="challengeTimeLimit" class="form-input" placeholder="30" min="10" max="300" value="30">
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="createChallenge()">Create Challenge</button>
                <button class="btn btn-secondary" onclick="hideModal('createChallengeModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Unified authentication check - works across all pages
        function getAuthToken() {
            return localStorage.getItem('token') || localStorage.getItem('authToken');
        }

        function isLoggedIn() {
            const token = getAuthToken();
            console.log('🔐 Auth check - Token exists:', !!token);
            if (token) {
                console.log('🔐 Token preview:', token.substring(0, 20) + '...');
            }
            return !!token;
        }
    </script>
    <script src="/js/settings.js"></script>
    <script>
        // Initialize particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'my-teams') loadMyTeams();
            if (tabName === 'public-teams') loadPublicTeams();
            if (tabName === 'themes') loadTeamThemes();
            if (tabName === 'challenges') loadChallenges();
            if (tabName === 'leaderboard') loadLeaderboardTeams();
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Alert modal functions (styled like index.html)
        function showAlert(title, message) {
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertModal').classList.add('active');
        }

        function hideAlert() {
            document.getElementById('alertModal').classList.remove('active');
        }

        function showCreateTeamModal() {
            showModal('createTeamModal');
        }

        function showJoinTeamModal() {
            showModal('joinTeamModal');
        }

        // API functions
        async function loadMyTeams() {
            const token = getAuthToken();
            console.log('📋 loadMyTeams - checking auth...');
            if (!token) {
                console.log('❌ No token found');
                document.getElementById('my-teams-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🔒</div>
                        <div class="empty-text">Please login to view your teams</div>
                        <button class="btn" onclick="location.href='/'">Go to Login</button>
                    </div>
                `;
                return;
            }
            console.log('✅ Token found, loading teams...');

            try {
                const response = await fetch('/api/teams', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.teams && data.teams.length > 0) {
                    renderTeams(data.teams, 'my-teams-list');
                    populateLeaderboardSelect(data.teams);
                } else {
                    document.getElementById('my-teams-list').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">👥</div>
                            <div class="empty-text">You haven't joined any teams yet</div>
                            <button class="btn" onclick="showCreateTeamModal()">Create Your First Team</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading teams:', error);
            }
        }

        async function loadPublicTeams() {
            try {
                const response = await fetch('/api/teams/popular');
                const data = await response.json();

                if (data.teams && data.teams.length > 0) {
                    renderTeams(data.teams, 'public-teams-list');
                    updateSearchResultsCount(data.teams.length, data.teams.length);
                }
            } catch (error) {
                console.error('Error loading public teams:', error);
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        const debouncedSearch = debounce(async function() {
            const searchInput = document.getElementById('teamSearchInput');
            const clearBtn = document.getElementById('clearSearchBtn');
            const query = searchInput.value.trim();

            if (query.length > 0) {
                clearBtn.classList.add('active');

                // Perform actual search
                try {
                    const response = await fetch(`/api/teams/search?q=${encodeURIComponent(query)}`);
                    const data = await response.json();

                    const container = document.getElementById('public-teams-list');
                    if (data.success && data.teams && data.teams.length > 0) {
                        container.innerHTML = data.teams.map(team => `
                            <div class="team-card" onclick="viewTeam(${team.id})">
                                <div class="team-header">
                                    <h3>${team.name}</h3>
                                    <span class="team-badge">${team.is_public ? 'Public' : 'Private'}</span>
                                </div>
                                <p class="team-description">${team.description || 'No description'}</p>
                                <div class="team-stats">
                                    <div class="stat">
                                        <div class="stat-value">${team.member_count || 0}</div>
                                        <div class="stat-label">Members</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-value">${team.theme_count || 0}</div>
                                        <div class="stat-label">Themes</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-value">${team.challenge_count || 0}</div>
                                        <div class="stat-label">Challenges</div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">🔍</div>
                                <div class="empty-text">No teams found matching "${query}"</div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Search error:', error);
                }
            } else {
                clearBtn.classList.remove('active');
                loadPublicTeams();
            }
        }, 300);

        function searchTeams() {
            debouncedSearch();
        }

        function clearSearch() {
            const searchInput = document.getElementById('teamSearchInput');
            const clearBtn = document.getElementById('clearSearchBtn');

            searchInput.value = '';
            clearBtn.classList.remove('active');
            loadPublicTeams();
        }

        function updateSearchResultsCount(showing, total) {
            const countElement = document.getElementById('searchResultsCount');
            if (showing === total) {
                countElement.textContent = `Showing all ${total} teams`;
            } else {
                countElement.textContent = `Showing ${showing} of ${total} teams`;
            }
        }

        function renderTeams(teams, containerId) {
            const container = document.getElementById(containerId);

            if (teams.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">👥</div>
                        <div class="empty-text">No teams found</div>
                        <button class="btn" onclick="showCreateTeamModal()">Create Your First Team</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = teams.map(team => `
                <div class="team-card" onclick="viewTeam(${team.id})">
                    <div class="team-header">
                        <div class="team-icon">👥</div>
                        <div class="team-info">
                            <div class="team-name">${team.name}</div>
                            <div class="team-code">CODE: ${team.team_code}</div>
                        </div>
                    </div>
                    <div class="team-description">${team.description || 'No description provided'}</div>
                    <div class="team-stats">
                        <div class="stat">
                            <div class="stat-value">${team.member_count || 0}</div>
                            <div class="stat-label">Members</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${team.theme_count || 0}</div>
                            <div class="stat-label">Themes</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${team.challenge_count || 0}</div>
                            <div class="stat-label">Challenges</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function createTeam() {
            const token = getAuthToken();
            console.log('🔨 createTeam - Token found:', token ? 'Yes' : 'No');

            if (!token) {
                showAlert('Authentication Required', 'Please login first to create a team.');
                setTimeout(() => { window.location.href = '/'; }, 2000);
                return;
            }

            const name = document.getElementById('teamName').value.trim();
            const description = document.getElementById('teamDescription').value.trim();
            const isPublic = document.getElementById('teamPublic').checked;

            if (!name) {
                showAlert('Team Name Required', 'Please enter a name for your team.');
                return;
            }

            console.log('Creating team:', { name, description, is_public: isPublic });

            try {
                const response = await fetch('/api/teams', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ name, description, is_public: isPublic })
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);

                if (data.success) {
                    hideModal('createTeamModal');
                    showAlert('Team Created!', `Success! Your team code is: ${data.team.team_code}\n\nShare this code with others to invite them to your team.`);
                    document.getElementById('teamName').value = '';
                    document.getElementById('teamDescription').value = '';
                    loadMyTeams();
                } else {
                    showAlert('Error', data.error || 'Failed to create team. Please try again.');
                }
            } catch (error) {
                console.error('Error creating team:', error);
                showAlert('Error', 'Failed to create team: ' + error.message);
            }
        }

        async function joinTeam() {
            const token = getAuthToken();
            if (!token) {
                showAlert('Authentication Required', 'Please login first to join a team.');
                return;
            }

            const teamCode = document.getElementById('joinTeamCode').value.toUpperCase().trim();
            if (!teamCode) {
                showAlert('Team Code Required', 'Please enter a team code to join.');
                return;
            }

            try {
                const response = await fetch('/api/teams/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ team_code: teamCode })
                });

                const data = await response.json();
                if (data.success) {
                    hideModal('joinTeamModal');
                    showAlert('Welcome!', 'You have successfully joined the team!');
                    document.getElementById('joinTeamCode').value = '';
                    loadMyTeams();
                } else {
                    showAlert('Error', data.error || 'Failed to join team. Please check the code and try again.');
                }
            } catch (error) {
                console.error('Error joining team:', error);
                showAlert('Error', 'Failed to join team. Please try again.');
            }
        }

        async function createTheme() {
            const token = getAuthToken();
            const teamId = document.getElementById('themeTeamSelect').value;
            const name = document.getElementById('themeName').value.trim();
            const description = document.getElementById('themeDescription').value.trim();
            const isPublic = document.getElementById('themePublic').checked;

            if (!teamId) {
                showAlert('Team Required', 'Please select a team for this theme.');
                return;
            }

            if (!name) {
                showAlert('Theme Name Required', 'Please enter a name for the theme.');
                return;
            }

            try {
                const response = await fetch(`/api/teams/${teamId}/themes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ name, description, is_public: isPublic })
                });

                const data = await response.json();
                if (data.success) {
                    hideModal('createThemeModal');
                    showAlert('Theme Created!', 'Your team theme has been created successfully!');
                    document.getElementById('themeName').value = '';
                    document.getElementById('themeDescription').value = '';
                    loadTeamThemes();
                } else {
                    showAlert('Error', data.error || 'Failed to create theme.');
                }
            } catch (error) {
                console.error('Error creating theme:', error);
                showAlert('Error', 'Failed to create theme: ' + error.message);
            }
        }

        async function createChallenge() {
            const token = getAuthToken();
            const teamId = document.getElementById('challengeTeamSelect').value;
            const name = document.getElementById('challengeName').value.trim();
            const description = document.getElementById('challengeDescription').value.trim();
            const themeId = document.getElementById('challengeThemeSelect').value;
            const numQuestions = document.getElementById('challengeQuestions').value;
            const timeLimit = document.getElementById('challengeTimeLimit').value;

            if (!teamId) {
                showAlert('Team Required', 'Please select a team for this challenge.');
                return;
            }

            if (!name) {
                showAlert('Challenge Name Required', 'Please enter a name for the challenge.');
                return;
            }

            if (!themeId) {
                showAlert('Theme Required', 'Please select a theme for this challenge.');
                return;
            }

            try {
                const response = await fetch(`/api/teams/${teamId}/challenges`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        name,
                        description,
                        theme_id: parseInt(themeId),
                        num_questions: parseInt(numQuestions),
                        time_limit: parseInt(timeLimit)
                    })
                });

                const data = await response.json();
                if (data.success) {
                    hideModal('createChallengeModal');
                    showAlert('Challenge Created!', 'Your team challenge has been created successfully!');
                    document.getElementById('challengeName').value = '';
                    document.getElementById('challengeDescription').value = '';
                    loadChallenges();
                } else {
                    showAlert('Error', data.error || 'Failed to create challenge.');
                }
            } catch (error) {
                console.error('Error creating challenge:', error);
                showAlert('Error', 'Failed to create challenge: ' + error.message);
            }
        }

        async function loadTeamThemes() {
            const token = getAuthToken();
            if (!token) {
                document.getElementById('themes-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🔒</div>
                        <div class="empty-text">Please login to view team themes</div>
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch('/api/teams/themes', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.success && data.themes && data.themes.length > 0) {
                    document.getElementById('themes-list').innerHTML = data.themes.map(theme => `
                        <div class="team-card" onclick="viewTheme(${theme.id})">
                            <div class="team-header">
                                <h3>${theme.name}</h3>
                                <span class="team-badge">${theme.is_public ? '🌐 Public' : '🔒 Private'}</span>
                            </div>
                            <p class="team-description">${theme.description || 'No description'}</p>
                            <div class="team-footer">
                                <span>📚 ${theme.question_count || 0} Questions</span>
                                <span>👥 ${theme.team_name}</span>
                                <span>👤 by ${theme.created_by || 'Unknown'}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('themes-list').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">📚</div>
                            <div class="empty-text">No team themes yet</div>
                            <button class="btn" onclick="showCreateThemeModal()">Create First Theme</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading themes:', error);
                document.getElementById('themes-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">❌</div>
                        <div class="empty-text">Error loading themes</div>
                    </div>
                `;
            }
        }

        async function loadChallenges() {
            const token = getAuthToken();
            if (!token) {
                document.getElementById('challenges-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🔒</div>
                        <div class="empty-text">Please login to view challenges</div>
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch('/api/teams/challenges', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.success && data.challenges && data.challenges.length > 0) {
                    document.getElementById('challenges-list').innerHTML = data.challenges.map(challenge => `
                        <div class="team-card" onclick="startChallenge(${challenge.id})">
                            <div class="team-header">
                                <h3>🎯 ${challenge.name}</h3>
                                <span class="team-badge">${challenge.status || 'Active'}</span>
                            </div>
                            <p class="team-description">${challenge.description || 'No description'}</p>
                            <div class="team-footer">
                                <span>📝 ${challenge.num_questions} Questions</span>
                                <span>⏱️ ${challenge.time_limit}s</span>
                                <span>👥 ${challenge.team_name}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('challenges-list').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">🎯</div>
                            <div class="empty-text">No challenges yet</div>
                            <button class="btn" onclick="showCreateChallengeModal()">Create First Challenge</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading challenges:', error);
                document.getElementById('challenges-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">❌</div>
                        <div class="empty-text">Error loading challenges</div>
                    </div>
                `;
            }
        }

        function viewTheme(themeId) {
            window.location.href = `/practice.html?theme=${themeId}`;
        }

        function startChallenge(challengeId) {
            window.location.href = `/quiz.html?challenge=${challengeId}`;
        }

        function populateLeaderboardSelect(teams) {
            const select = document.getElementById('leaderboardTeamSelect');
            select.innerHTML = '<option value="">Select a team...</option>' +
                teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('');
        }

        function loadLeaderboardTeams() {
            loadMyTeams();
        }

        async function loadLeaderboard() {
            const teamId = document.getElementById('leaderboardTeamSelect').value;
            if (!teamId) {
                document.getElementById('leaderboard-table').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🏆</div>
                        <div class="empty-text">Select a team to view its leaderboard</div>
                    </div>
                `;
                return;
            }

            const token = getAuthToken();
            try {
                const response = await fetch(`/api/teams/${teamId}/leaderboard`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.leaderboard && data.leaderboard.length > 0) {
                    renderLeaderboard(data.leaderboard);
                }
            } catch (error) {
                console.error('Error loading leaderboard:', error);
            }
        }

        function renderLeaderboard(entries) {
            const container = document.getElementById('leaderboard-table');
            container.innerHTML = `
                <div class="leaderboard-table">
                    <div class="leaderboard-header">
                        <div>Rank</div>
                        <div>Player</div>
                        <div>Score</div>
                        <div>Games</div>
                    </div>
                    ${entries.map((entry, index) => {
                        let rankClass = '';
                        if (index === 0) rankClass = 'gold';
                        else if (index === 1) rankClass = 'silver';
                        else if (index === 2) rankClass = 'bronze';

                        return `
                            <div class="leaderboard-row">
                                <div class="rank ${rankClass}">#${index + 1}</div>
                                <div class="player-name">${entry.username || entry.display_name}</div>
                                <div class="score">${(entry.total_score || 0).toLocaleString()}</div>
                                <div class="games">${entry.quizzes_played || 0}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function viewTeam(teamId) {
            console.log('View team:', teamId);
        }

        async function showCreateThemeModal() {
            // Load user's teams into the select dropdown
            const token = getAuthToken();
            if (!token) {
                showAlert('Authentication Required', 'Please login first to create a theme.');
                return;
            }

            try {
                const response = await fetch('/api/teams', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                const select = document.getElementById('themeTeamSelect');
                select.innerHTML = '<option value="">Select a team...</option>';

                if (data.success && data.teams && data.teams.length > 0) {
                    data.teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.id;
                        option.textContent = team.name;
                        select.appendChild(option);
                    });
                    showModal('createThemeModal');
                } else {
                    showAlert('No Teams', 'Please create or join a team first before creating themes.');
                }
            } catch (error) {
                console.error('Error loading teams:', error);
                showAlert('Error', 'Failed to load teams. Please try again.');
            }
        }

        async function showCreateChallengeModal() {
            // Load user's teams into the select dropdown
            const token = getAuthToken();
            if (!token) {
                showAlert('Authentication Required', 'Please login first to create a challenge.');
                return;
            }

            try {
                const response = await fetch('/api/teams', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                const teamSelect = document.getElementById('challengeTeamSelect');
                teamSelect.innerHTML = '<option value="">Select a team...</option>';

                if (data.success && data.teams && data.teams.length > 0) {
                    data.teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.id;
                        option.textContent = team.name;
                        teamSelect.appendChild(option);
                    });

                    // Load themes
                    loadThemesForChallenge();
                    showModal('createChallengeModal');
                } else {
                    showAlert('No Teams', 'Please create or join a team first before creating challenges.');
                }
            } catch (error) {
                console.error('Error loading teams:', error);
                showAlert('Error', 'Failed to load teams. Please try again.');
            }
        }

        async function loadThemesForChallenge() {
            try {
                const response = await fetch('/api/themes');
                const themes = await response.json();

                const select = document.getElementById('challengeThemeSelect');
                select.innerHTML = '<option value="">Select a theme...</option>';

                if (themes && themes.length > 0) {
                    themes.forEach(theme => {
                        const option = document.createElement('option');
                        option.value = theme.id;
                        option.textContent = theme.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading themes:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            loadMyTeams();

            document.addEventListener('keydown', (e) => {
                if (e.key === '/' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    const searchInput = document.getElementById('teamSearchInput');
                    const publicTeamsTab = document.getElementById('public-teams');

                    if (!publicTeamsTab.classList.contains('active')) {
                        document.querySelectorAll('.tab').forEach((tab, index) => {
                            if (index === 1) tab.click();
                        });
                    }
                    setTimeout(() => searchInput.focus(), 100);
                }

                if (e.key === 'Escape' && e.target === document.getElementById('teamSearchInput')) {
                    clearSearch();
                }
            });
        });

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
